<!DOCTYPE html>    
<html lang="id">    
<head>    
<meta charset="UTF-8" />    
  <meta name="author" content="Y&Z Studio - Powered by AI & Human Creativity">    
<meta name="copyright" content="¬© 2025 Y&Z Studio - yudabastard84@gmail.com">    
	<!-- Meta dasar -->    
<meta charset="UTF-8">    
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">    
<meta name="theme-color" content="#1e1e1e"> <!-- Warna status bar -->    
<meta name="mobile-web-app-capable" content="yes">    
<meta name="apple-mobile-web-app-capable" content="yes">    
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">    
<meta name="apple-mobile-web-app-title" content="My Audio App">    
    
<!-- PWA Manifest -->    
<link rel="manifest" href="manifest.json" />    
<link rel="icon" type="image/png" sizes="192x192" href="192.png" />    
<link rel="apple-touch-icon" href="192.png" />    
    
<!-- SEO -->    
	<title>My Video App -  Offline</title>    
<meta name="description" content="Play your favorite video files offline with rich EQ and player features.">    
    
<!-- OG (untuk share) -->    
<meta property="og:title" content="My Video App">    
<meta property="og:description" content="A fast, offline-ready Video player PWA. Try now!">    
<meta property="og:image" content="icon-512.png">    
<meta property="og:type" content="website">    
<meta property="og:url" content="https://yoursite.com/">    
    
<!-- Optional favicon -->    
<link rel="shortcut icon" href="icon-192.png" type="image/png">    
  <title>Mini Video Player PWA</title>    
  <style>    
  	  	    * {  
      margin: 0;  
      padding: 0;  
      box-sizing: border-box;  
    }  

  video, canvas, img {
    filter: brightness(95%);
  }
    
:root {
  --color-primary: rgba(0, 255, 238, 0.08);       /* soft glass base */
  --color-accent: #ff4de8;
  --color-background: linear-gradient(120deg, #0e0e0e, #1a1a1a);
  --shadow-depth: 0 10px 32px rgba(0, 255, 255, 0.15);
  --glow-effect: 0 0 12px rgba(0, 255, 238, 0.6);

  --glass-blur: blur(18px);
  --border-glass: rgba(255, 255, 255, 0.1);
  --color-glow: rgba(0, 255, 238, 0.25);
}

body {
  background-image: var(--color-background), url('assets/bg.jpg');
  background-size: cover, cover;
  background-position: center, center;
  background-repeat: no-repeat, no-repeat;
  background-attachment: fixed, fixed;
  color: white;
  font-family: 'Poppins', sans-serif;
  filter: contrast(105%) saturate(115%) brightness(1.03);
  margin: 0;
  padding: 0;
}

/* Retina Glass Card */
.glass-retina {
  background: var(--color-primary);
  backdrop-filter: var(--glass-blur);
  -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--border-glass);
  border-radius: 20px;
  box-shadow:
    inset 0 0 0.5px rgba(255, 255, 255, 0.1),
    0 4px 16px var(--color-glow),
    0 8px 24px rgba(0, 0, 0, 0.2);
  padding: 24px;
  transition: all 0.4s ease;
}

/* Hover effect (optional) */
.glass-retina:hover {
  transform: scale(1.02);
  box-shadow:
    inset 0 0 1px rgba(255, 255, 255, 0.15),
    0 6px 28px rgba(0, 255, 238, 0.35),
    0 12px 36px rgba(0, 0, 0, 0.3);
}

/* 3D Card Base */
.card-3d {
  box-shadow: var(--shadow-depth);
  transform: perspective(900px) rotateX(2deg);
  backdrop-filter: blur(12px) brightness(1.08);
  border-radius: 16px;
  padding: 20px;
  transition: all 0.4s ease;
}

  .visual-mode-all {
    filter:
      hue-rotate(5deg)
      saturate(1.6)
      contrast(1.2)
      brightness(1.1)
      contrast(1.1)
      brightness(0.95)
      saturate(1.2)
      brightness(1.3)
      contrast(1.25)
      saturate(1.4);
    transform: perspective(1000px) rotateX(2deg);
    border-radius: 12px;
    transition: all 0.5s ease;
  }

/* ====== Global Reset & Base ====== */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #111;
  font-family: sans-serif;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ====== File Input Button ====== */
#fileInput {
  display: none;
}
#openButton {
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 1001;
  background: rgba(255, 255, 255, 0.1);
  padding: 10px 15px;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
}

/* ====== Main Video Container ====== */
#videoContainer {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
  z-index: 1;
}

#videoContainer video {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Orientation: Portrait */
@media (orientation: portrait) {
  #videoContainer video {
    width: auto;
    height: 100vh;
    object-fit: contain;
  }
}
/* Orientation: Landscape */
@media (orientation: landscape) {
  #videoContainer video {
    width: 100vw;
    height: auto;
    object-fit: cover;
  }
}

/* ====== Mini Player ====== */
#miniPlayer {
  position: fixed;
  bottom: 10px;
  right: 10px;
  width: 200px;
  height: 112.5px; /* 16:9 */
  background: #111;
  border-radius: 10px;
  overflow: hidden;
  z-index: 9999;
  display: none; /* default hidden */
}
#miniPlayer video,
#miniVideo {
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: #000;
}

/* ====== Floating Player Wrapper (PIP) ====== */
#floatingVideoWrapper {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 200px;
  background: #000;
  border-radius: 10px;
  overflow: hidden;
  cursor: move;
  z-index: 9999;
}
#floatingVideoWrapper video {
  width: 100%;
  display: block;
}

/* ====== Video Wrapper (Hidden by Default) ====== */
.video-wrapper {
  width: 100%;
  height: 100%;
  background: #000;
  display: none;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  cursor: move;
  z-index: 9999;
}
    body {    
      margin: 0;    
      padding: 0;    
      background: #111;  
      display: flex;    
      justify-content: center;    
      align-items: center;    
      height: 100vh;    
    }    

    video {      
      max-width: 100%;      
      max-height: 100%;      
      object-fit: contain;      
      background: #000;      
    }      

/* ====== Player Container (Fullscreen) ====== */
.player-container {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: black;
}
.player-container video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ====== Branding Removal ====== */
.vjs-watermark, .plyr__branding, .branding, .video-branding,
.vjs-powered-by, .vjs-branding, .plyr__badge {
  display: none !important;
  opacity: 0 !important;
  visibility: hidden !important;
}

#eqPreset {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  background: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 14px;
}
    
          @supports (backdrop-filter: blur(10px)) {
  .glass {
    backdrop-filter: blur(10px);
  }
}
    
      .glass {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  box-shadow: 0 0 30px rgba(0, 200, 255, 0.3);
  border-radius: 15px;
}
  
  .dynamic-light {
  background: radial-gradient(circle at var(--x) var(--y), rgba(255,255,255,0.1), transparent 80%);
}

    #realisticPlayer {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  filter: brightness(1.1) contrast(1.25) saturate(1.15)
          drop-shadow(0 0 30px rgba(0,255,255,0.1))
          drop-shadow(0 0 40px rgba(255,255,255,0.05))
          blur(0.3px);
  transition: all 1s ease-in-out;
  background: radial-gradient(circle at center, #111 10%, #000 100%);
}

  </style>    
</head>      
	<body onclick="enterFullscreenOnce()">      
		    
		<div id="videoContainer">
  <div id="videoWrapper">
    <video id="mainVideo" playsinline></video>
  </div>
</div>
      
<!-- FILE INPUT + OPEN BUTTON -->    
<input type="file" id="fileInput" accept="video/*" hidden />    
<button id="openButton">üìÅ Ambil Video</button>    
   
<select id="eqPreset">
    	  <option value="Same Soft">Same Soft</option>
  <option value="Broadcast Voice">Broadcast Voice</option>
  <option value="Live Concert Hall">Live Concert Hall</option>
  <option value="Music Video Pop">Music Video Pop</option>
    <option value="Studio Cover">Studio Cover</option>
      <option value="EDM Visualizer">EDM Visualizer</option>
  <option value="Horror Ambience">Horror Ambience</option>
      <option value="Action Film Punch">Action Film Punch</option>
  <option value="Romantic Drama">Romantic Drama</option>
  <option value="Orchestra Film Score">Orchestra Film Score</option>
        <option value="Surround Feel">Surround Feel</option>
</select>
    
    <div class="retina-glass">
	<div id="visualMode" class="content-overlay visual-mode-all">
		
<div class="bg-cover"></div>  
<div class="content">  
	<div class="bg-vivid"></div>  
<div class="glass-mask"></div>  
	

	<!-- Script Three.js -->
<canvas id="hiddenCanvas" style="display: none;"></canvas>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script>
  window.addEventListener("error", e => console.error("‚ùå Global Error:", e.message));

  const fileInput = document.getElementById("fileInput");
  const openButton = document.getElementById("openButton");
  const mainVideo = document.getElementById("mainVideo");
  const videoContainer = document.getElementById("videoContainer");
  const wrapper = document.getElementById("videoWrapper");

  let hasEnteredFullscreen = false;
  let isDragging = false, offsetX = 0, offsetY = 0;

  // ========== Buka File ==========
  openButton.onclick = () => fileInput.click();

  fileInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const url = URL.createObjectURL(file);

    if (mainVideo.src) {
      mainVideo.pause();
      mainVideo.removeAttribute("src");
      mainVideo.load();
    }

    mainVideo.src = url;
    mainVideo.autoplay = true;
    mainVideo.controls = true;
    mainVideo.playsInline = true;
    mainVideo.play().catch(() => {});

    requestFullscreenLandscape();
  });

  // ========== Fullscreen & Orientation ==========
  function requestFullscreenLandscape() {
    if (screen.orientation?.lock) {
      screen.orientation.lock("landscape").catch(() => {});
    }

    if (mainVideo.requestFullscreen) {
      mainVideo.requestFullscreen().catch(() => {});
    } else if (mainVideo.webkitRequestFullscreen) {
      mainVideo.webkitRequestFullscreen();
    }
  }

  mainVideo.addEventListener("play", () => {
    if (screen.orientation?.lock) {
      screen.orientation.lock("landscape").catch(err =>
        console.warn("Gagal rotasi otomatis:", err)
      );
    }
  });

  // ========== Adaptive Aspect Ratio ==========
  mainVideo.addEventListener("loadedmetadata", () => {
    const w = mainVideo.videoWidth;
    const h = mainVideo.videoHeight;
    const aspectRatio = w / h;

    if (aspectRatio > 1.1) {
      wrapper.style.aspectRatio = "16 / 9";
    } else if (aspectRatio < 0.9) {
      wrapper.style.aspectRatio = "9 / 16";
    } else {
      wrapper.style.aspectRatio = "1 / 1";
    }
  });

  window.addEventListener("orientationchange", () => {
    if (window.innerHeight > window.innerWidth) {
      wrapper.style.aspectRatio = "9 / 16";
    } else {
      wrapper.style.aspectRatio = "16 / 9";
    }
  });

  const observer = new ResizeObserver(() => {
    const w = mainVideo.clientWidth;
    const h = mainVideo.clientHeight;
    const aspectRatio = w / h;

    if (aspectRatio > 1.1) {
      mainVideo.style.aspectRatio = "16 / 9";
    } else if (aspectRatio < 0.9) {
      mainVideo.style.aspectRatio = "9 / 16";
    } else {
      mainVideo.style.aspectRatio = "1 / 1";
    }
  });

  observer.observe(mainVideo);

  // ========== Fullscreen Once on Tap ==========
  window.addEventListener("click", () => {
    if (!hasEnteredFullscreen) {
      videoContainer?.requestFullscreen?.().catch(err =>
        console.warn("Fullscreen gagal:", err)
      );
      hasEnteredFullscreen = true;
    }
    mainVideo.play().catch(() => {});
  });

  // ========== Drag & Scroll Behavior ==========
  wrapper.addEventListener("mousedown", (e) => {
    isDragging = true;
    offsetX = e.clientX - wrapper.offsetLeft;
    offsetY = e.clientY - wrapper.offsetTop;
  });

  document.addEventListener("mousemove", (e) => {
    if (!isDragging) return;
    wrapper.style.left = `${e.clientX - offsetX}px`;
    wrapper.style.top = `${e.clientY - offsetY}px`;
    wrapper.style.right = "auto";
    wrapper.style.bottom = "auto";
  });

  document.addEventListener("mouseup", () => {
    isDragging = false;
  });

  window.addEventListener("scroll", () => {
    if (window.scrollY > 150) {
      wrapper.style.width = "180px";
      wrapper.style.bottom = "20px";
      wrapper.style.right = "20px";
    } else {
      wrapper.style.width = "100%";
      wrapper.style.position = "relative";
      wrapper.style.right = "auto";
      wrapper.style.bottom = "auto";
    }
  });

  // ========== Portrait Mode Class (optional CSS trigger) ==========
  function applyPortraitMode() {
    if (window.matchMedia("(orientation: portrait)").matches) {
      mainVideo.classList.add("portraitVideo");
    } else {
      mainVideo.classList.remove("portraitVideo");
    }
  }




  const player = document.getElementById("mainVideo");
  const eqPresetSelect = document.getElementById("eqPreset");

// ‚úÖ REFACTORED AUDIO EQ + VOLUME++ SCRIPT
let audioCtx, sourceNode, gainNode, compressorNode;
let eqNodes = [];
let isVideoLoaded = false;
let filters = [];
let isAudioReady = false;

  const Bands = [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000, 12000, 14000, 16000];

// =============== PRESET EQ ===============
const eqPresets = {
	  "Same Soft": {  
    eq: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],  
    compressor: { threshold: -22, ratio: 1.5, attack: 0.05 },  
    enhancer: { presence: 0, brilliance: 0, warmth: 0 },  
    reverb: 0.0,  
    stereoWidth: 0.5  
   },  
  "Broadcast Voice": {  
    eq: [3, 4, 3, 1, 0, -2, -3, -4, -3, -1, 1, 2],  
    compressor: { threshold: -20, ratio: 3, attack: 0.01 },  
    enhancer: { presence: 4, brilliance: 2, warmth: 1 },  
    reverb: 0.05,  
    stereoWidth: 0.4  
  },  
  "Live Concert Hall": {  
    eq: [5, 3, 0, -2, -3, -2, 0, 2, 3, 4, 5, 6],  
    compressor: { threshold: -15, ratio: 2.5, attack: 0.03 },  
    enhancer: { presence: 2, brilliance: 4, warmth: 2 },  
    reverb: 0.6,  
    stereoWidth: 1.0  
  },  
  "Music Video Pop": {  
    eq: [4, 3, 1, -1, -2, -1, 1, 2, 4, 5, 6, 5],  
    compressor: { threshold: -18, ratio: 3, attack: 0.02 },  
    enhancer: { presence: 3, brilliance: 4, warmth: 1 },  
    reverb: 0.2,  
    stereoWidth: 0.9  
  },  
  "Studio Cover": {  
    eq: [2, 3, 3, 2, 0, -1, -2, -2, 0, 2, 3, 3],  
    compressor: { threshold: -16, ratio: 2.5, attack: 0.01 },  
    enhancer: { presence: 3, brilliance: 2, warmth: 3 },  
    reverb: 0.1,  
    stereoWidth: 0.7  
  },  
  "EDM Visualizer": {  
    eq: [6, 5, 3, 0, -2, -1, 1, 3, 5, 6, 6, 6],  
    compressor: { threshold: -12, ratio: 4, attack: 0.005 },  
    enhancer: { presence: 4, brilliance: 5, warmth: 1 },  
    reverb: 0.4,  
    stereoWidth: 1.0  
  },  
  "Horror Ambience": {  
    eq: [-2, -3, -4, -2, 0, 1, 3, 4, 3, 2, 1, 0],  
    compressor: { threshold: -25, ratio: 1.8, attack: 0.1 },  
    enhancer: { presence: 1, brilliance: 0, warmth: 5 },  
    reverb: 0.6,  
    stereoWidth: 0.8  
  },  
  "Action Film Punch": {  
    eq: [5, 4, 2, 0, -1, -2, -1, 2, 4, 5, 4, 3],  
    compressor: { threshold: -10, ratio: 4, attack: 0.008 },  
    enhancer: { presence: 4, brilliance: 3, warmth: 2 },  
    reverb: 0.2,  
    stereoWidth: 0.95  
  },  
  "Romantic Drama": {  
    eq: [1, 2, 1, 0, -1, -1, 0, 2, 3, 2, 1, 1],  
    compressor: { threshold: -22, ratio: 2.2, attack: 0.015 },  
    enhancer: { presence: 2, brilliance: 1, warmth: 4 },  
    reverb: 0.3,  
    stereoWidth: 0.75  
  },  
  "Orchestra Film Score": {  
    eq: [3, 3, 2, 0, -1, -2, -1, 2, 3, 4, 5, 6],  
    compressor: { threshold: -18, ratio: 3, attack: 0.01 },  
    enhancer: { presence: 2, brilliance: 3, warmth: 3 },  
    reverb: 0.5,  
    stereoWidth: 1.0  
  },  
  "Natural Documentary": {  
    eq: [1, 1, 0, 0, 0, 0, 0, 0, 1, 2, 1, 1],  
    compressor: { threshold: -24, ratio: 1.5, attack: 0.03 },  
    enhancer: { presence: 1, brilliance: 1, warmth: 2 },  
    reverb: 0.1,  
    stereoWidth: 0.5  
  },  
  "City Streets Scene": {  
    eq: [0, -1, -2, -1, 0, 1, 2, 3, 3, 2, 1, 0],  
    compressor: { threshold: -20, ratio: 2.5, attack: 0.02 },  
    enhancer: { presence: 2, brilliance: 1, warmth: 2 },  
    reverb: 0.2,  
    stereoWidth: 0.8  
  },  
  "Surround Feel": {  
    eq: [4, 3, 2, 0, -2, -3, -1, 1, 3, 4, 5, 4],  
    compressor: { threshold: -16, ratio: 3.5, attack: 0.01 },  
    enhancer: { presence: 3, brilliance: 4, warmth: 3 },  
    reverb: 0.4,  
    stereoWidth: 1.0  
  }  
};  

// === üéß PRESET EQ DEFINITION
const volumeBoostPresets = {
  "Volume++": {
    eq: [2, 1.5, 1.2, 0.8, 0, 1, 1.8, 2.2, 2.8, 3.5, 3, 2],
    enhancer: 1.4,
compressor: {
  threshold: -13.5,
  ratio: 4,
  attack: 0.003
},
limiter: {
  enabled: true,
  threshold: -2.8
},
    stereoWidth: 1.08,
    reverb: {
      enabled: false
    },
    filters: (ctx) => {
      const lowShelf = ctx.createBiquadFilter();
      lowShelf.type = "lowshelf";
      lowShelf.frequency.value = 55;
      lowShelf.gain.value = 0.3;

      const subDip = ctx.createBiquadFilter();
      subDip.type = "peaking";
      subDip.frequency.value = 90;
      subDip.Q.value = 1.2;
      subDip.gain.value = -1.5;

      const lowMidCut = ctx.createBiquadFilter();
      lowMidCut.type = "peaking";
      lowMidCut.frequency.value = 280;
      lowMidCut.Q.value = 1.2;
      lowMidCut.gain.value = -1.6;

      const midBody = ctx.createBiquadFilter();
      midBody.type = "peaking";
      midBody.frequency.value = 1150;
      midBody.Q.value = 1.3;
      midBody.gain.value = 1.2;

      const clarity = ctx.createBiquadFilter();
      clarity.type = "peaking";
      clarity.frequency.value = 3800;
      clarity.Q.value = 1.1;
      clarity.gain.value = 0.7;

      const highShelf = ctx.createBiquadFilter();
      highShelf.type = "highshelf";
      highShelf.frequency.value = 9000;
      highShelf.gain.value = 0.4;

      const air = ctx.createBiquadFilter();
      air.type = "highshelf";
      air.frequency.value = 17000;
      air.gain.value = 0.25;

      const harshTamer = ctx.createBiquadFilter();
      harshTamer.type = "peaking";
      harshTamer.frequency.value = 5300;
      harshTamer.Q.value = 4.2;
      harshTamer.gain.value = -1.4;

      const shimmer = ctx.createBiquadFilter();
      shimmer.type = "highshelf";
      shimmer.frequency.value = 16000;
      shimmer.gain.value = 0.1;

      return [
        lowShelf, subDip, lowMidCut, midBody, clarity,
        harshTamer, highShelf, air, shimmer
      ];
    }
  },
};

// === GABUNG SEMUA PRESET
const allPresets = { ...eqPresets }; 

// === Inisialisasi audio pipeline sekali saja
function initAudioContext() {
  if (isAudioReady) return;

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  sourceNode = audioCtx.createMediaElementSource(player);

  gainNode = audioCtx.createGain();
  compressorNode = audioCtx.createDynamicsCompressor();

  gainNode.gain.value = 1.3;

  sourceNode.connect(gainNode);
  gainNode.connect(compressorNode);
  compressorNode.connect(audioCtx.destination);

  isAudioReady = true;
  console.log("üéß AudioContext siap");

  // Aktifkan Volume++ langsung
  const volPreset = volumeBoostPresets["Volume++"];
  if (volPreset) applyPreset(volPreset, "Volume++ (auto)");
}

function applyPreset(preset, name) {
  if (!isAudioReady) return;

  try {
    // Disconnect filter lama dari gainNode
    filters.forEach(f => f.disconnect());
  } catch (e) {
    console.warn("üîå Disconnect error", e);
  }

  filters = [];

  if (preset.eq && Array.isArray(preset.eq)) {
    preset.eq.forEach((gainVal, i) => {
      const filter = audioCtx.createBiquadFilter();
      filter.type = "peaking";
      filter.frequency.value = Bands[i];
      filter.Q.value = 1;
      filter.gain.value = gainVal;
      filters.push(filter);
    });

    // Rangkai ulang: gainNode ‚Üí filters ‚Üí compressorNode
    gainNode.disconnect();
    let chain = [gainNode, ...filters, compressorNode];
    for (let i = 0; i < chain.length - 1; i++) {
      chain[i].connect(chain[i + 1]);
    }
  }

  if (preset.compressor) {
    compressorNode.threshold.value = preset.compressor.threshold;
    compressorNode.ratio.value = preset.compressor.ratio;
    compressorNode.attack.value = preset.compressor.attack;
  }

  console.log(`‚úÖ Preset aktif: ${name}`);
}

let isDropdownReady = false;

function setupPresetDropdown() {
  eqPresetSelect.innerHTML = "";

  for (const name in allPresets) {
    const option = document.createElement("option");
    option.value = name;
    option.textContent = name;
    eqPresetSelect.appendChild(option);
  }

  if (!isDropdownReady) {
    eqPresetSelect.addEventListener("change", () => {
      const selected = eqPresetSelect.value;
      const preset = allPresets[selected];
      if (preset) applyPreset(preset, selected);
    });
    isDropdownReady = true;
  }
}

// üöÄ INIT
setupPresetDropdown();
initAudioContext();

player.addEventListener("play", async () => {
  if (audioCtx.state === "suspended") await audioCtx.resume();
});

function safeDisconnect(node) {
  try { node?.disconnect(); } catch (e) {}
}

function applyStereoRoutingAuto() {
  if (!audioCtx) return console.warn("AudioContext belum siap");
  if (!eqNodes?.length) return console.warn("EQ nodes belum siap");

  safeDisconnect(eqNodes[eqNodes.length - 1]);
  safeDisconnect(stereoPanner);
  safeDisconnect(stereoGain);
  safeDisconnect(crossfeed);
  safeDisconnect(stereoAnalyser);

  const finalNode = eqNodes[eqNodes.length - 1];

  // Crossfeed selalu aktif
  crossfeed = audioCtx.createGain();
  crossfeed.gain.value = 0.05; // sesuaikan kalau perlu
  finalNode.connect(crossfeed);
  crossfeed.connect(audioCtx.destination);

  stereoPanner = audioCtx.createStereoPanner();
  stereoGain = audioCtx.createGain();
  stereoGain.gain.value = 0.9;

  stereoAnalyser = audioCtx.createAnalyser();
  stereoAnalyser.fftSize = 256;

  finalNode.connect(stereoPanner);
  stereoPanner.connect(stereoGain);
  stereoGain.connect(audioCtx.destination);
  stereoGain.connect(stereoAnalyser);

  startSlowPan();
}

function startSlowPan() {
  stopSlowPan();
  panPos = 0;
  panDir = 1;

  panTimer = setInterval(() => {
    if (!stereoPanner) return;
    panPos += panDir * 0.002;
    if (panPos >= 0.8 || panPos <= -0.8) panDir *= -1;
    stereoPanner.pan.setValueAtTime(panPos, audioCtx.currentTime);
    drawStereoPanVisual?.();
  }, 30);
}

function stopSlowPan() {
  if (panTimer) {
    clearInterval(panTimer);
    panTimer = null;
  }
}

    let running = false;
let rafId;

function loop60fps() {
  if (!running) return;
  rafId = requestAnimationFrame(loop60fps);
}

function startLoop() {
  if (!running) {
    running = true;
    console.log("60FPS Loop:  ON");
    loop60fps();
  }
}

function stopLoop() {
  if (running) {
    running = false;
    cancelAnimationFrame(rafId);
    console.log("60FPS Loop:  OFF");
  }
}

// Expose buat bisa dipanggil di console
window.startLoop = startLoop;
window.stopLoop = stopLoop;

// Auto start kalau mau
startLoop();

  window.addEventListener('DOMContentLoaded', () => {
  const el = document.getElementById("visualMode");

  if (!el) {
    console.warn("Elemen #visualMode tidak ditemukan!");
    return;
  }

  console.log("üîµ Mode visual aktif!");

  // Tes tambahkan class manual satu-satu
  el.classList.add("dolby-vision");
  el.classList.remove("bravia-cinematic");
  el.classList.toggle("huawei-vivid");

  // Gabungan semuanya?
  el.classList.add("visual-mode-all");
});


const visualEngineSettings = {
  postProcess: {
    exposure: {
      minBrightness: 0.8,
      maxBrightness: 1.2,
      autoAdjust: true,
      speed: 0.15
    },
    contrast: 1.15,
    saturation: 1.1,
    bloom: {
      enabled: true,
      intensity: 0.3,
      threshold: 1.1
    },
    vignette: {
      enabled: true,
      intensity: 0.15,
      smoothness: 0.6
    },
    chromaticAberration: {
      enabled: true,
      intensity: 0.02
    },
    motionBlur: {
      enabled: true,
      shutterAngle: 90
    },
    colorGrading: {
      lift: [1.0, 1.0, 1.0],
      gamma: [1.05, 1.05, 1.05],
      gain: [1.1, 1.1, 1.1]
    },
    lensFlare: {
      enabled: true,
      intensity: 0.2
    },
    ambientOcclusion: {
      enabled: true,
      radius: 0.5,
      intensity: 0.6
    },
    depthOfField: {
      enabled: true,
      focalDistance: 3.0,
      aperture: 2.8,
      blurAmount: 0.5
    }
  },
  skybox: {
    type: "gradient",
    topColor: "#1c1c2a",
    bottomColor: "#5c6c80"
  },
  lighting: {
    direction: [0.5, -1, 0.3],
    intensity: 1.0,
    color: "#ffffff",
    shadows: true
  },
  autoControl: {
    autoplay: true,
    loop: true,
    muted: false,
    volume: 1.0,
    controlsVisible: false
  }
};

  const canvas = document.getElementById("hiddenCanvas");

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
  camera.position.z = 5;

  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
  renderer.setSize(256, 256); // kecilin ukuran, cukup buat proses belakang layar

  // Buat object 3D
  const geometry = new THREE.BoxGeometry(2, 2, 2);
  const material = new THREE.MeshStandardMaterial({ color: 0x00ffcc });
  const cube = new THREE.Mesh(geometry, material);
  scene.add(cube);

  // Lighting
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5, 5, 5);
  scene.add(light);

  // Render loop (background)
  let frame = 0;
  function animate() {
    requestAnimationFrame(animate);
    cube.rotation.x += 0.01;
    cube.rotation.y += 0.01;

    renderer.render(scene, camera);

    if (++frame % 60 === 0) {
      console.log("üé• Background 3D rendering still active", frame);
    }
  }

  animate();
  

    
      if ('serviceWorker' in navigator) {        
    navigator.serviceWorker.register('sw.js')        
      .then(reg => console.log('‚úÖ Service Worker registered:', reg.scope))        
      .catch(err => console.error('‚ùå Service Worker registration failed:', err));        
  }        
    
console.log("‚úÖ Script Loaded");    
  </script>    
</body>    
</html>  
  
  
  
