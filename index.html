<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üéµ YZ Audio EQ Player</title>
<style>
  * {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }
  body {
    margin: 0;
    padding: 16px;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0d111a, #1e2a3b);
    color: #0ff;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    flex-direction: column;
  }
  .player-container {
    background: transparent;
    max-width: 920px;
    width: 100%;
    padding: 20px;
  }
  #audioPlayer {
    width: 100%;
    border-radius: 16px;
    background: transparent;
    outline: none;
    margin-bottom: 20px;
  }
  .row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin: 20px auto;
    max-width: 800px;
    align-items: center;
  }
  .row label {
    font-size: 0.9em;
    margin-right: 8px;
    color: #0ff;
    text-shadow: 0 0 5px rgba(0,255,255,0.8);
  }
  .row select,
  .row input[type=range],
  .row button {
    flex: 1 1 140px;
    min-width: 100px;
    max-width: 180px;
    padding: 10px;
    border-radius: 12px;
    border: none;
    background: rgba(0, 255, 255, 0.15);
    color: #0ff;
    font-size: 1em;
    backdrop-filter: blur(8px);
    cursor: pointer;
    transition: background 0.3s;
    text-shadow: 0 0 5px #0ff;
  }
  .row button:hover {
    background: rgba(0, 255, 255, 0.4);
  }
  .status {
    font-weight: bold;
    padding-left: 10px;
    min-width: 120px;
    text-align: center;
  }
  .status.on {
    color: #6f6;
    text-shadow: 0 0 8px #6f6;
  }
  .status.off {
    color: #f66;
    text-shadow: 0 0 8px #f66;
  }
  #manual-eq-sliders {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 6px;
    justify-content: center;
    align-items: end;
    margin: 25px auto;
    padding: 0 10px;
    max-width: 100%;
  }
  .eq-col {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .eq-slider {
    writing-mode: bt-lr;
    -webkit-appearance: slider-vertical;
    width: 16px;
    height: 120px;
    background: transparent;
    accent-color: #0ff;
    cursor: pointer;
    margin-bottom: 6px;
  }
  .eq-col span {
    font-size: 0.65em;
    color: #0ff;
    text-shadow: 0 0 5px rgba(0,255,255,0.8);
    text-align: center;
  }
  #visualizer {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    z-index: -1;
    pointer-events: none;
    background: transparent !important;
  }
</style>
</head>
<body>
  <div class="player-container">
    <input type="file" id="folderPicker" webkitdirectory multiple accept="audio/*" />
    <p id="nowPlaying">Now Playing: -</p>
    <audio id="audioPlayer" controls></audio>

    <div class="row">
      <input type="range" id="volumeRange" min="0" max="2.5" value="1" step="0.01" />
      <span id="gain-info">üîä Volume: 1.00x</span>
    </div>

    <div class="row">
      <label for="preset-select">üéöÔ∏è EQ Preset:</label>
      <select id="preset-select">
        <option value="flat">Flat</option>
        <option value="bass">Bass</option>
        <option value="treble">Treble</option>
        <option value="rock">Rock</option>
        <option value="pop">Pop</option>
        <option value="jazz">Jazz</option>
        <option value="dance">Dance</option>
        <option value="classic">Classic</option>
      </select>
    </div>

    <div class="row">
      <button id="toggleClarity">‚ú® Aktifkan Clarity</button>
      <span id="status" class="status off">Clarity: OFF</span>
    </div>

    <div class="row">
      <button id="blendToggleBtn">üéõÔ∏è Aktifkan Blend</button>
      <span id="blendStatus" class="status off">Blend: OFF</span>
    </div>

    <div class="row">
      <select id="presetA">
        <option value="flat">Flat</option>
        <option value="rock">Rock</option>
        <option value="pop">Pop</option>
        <option value="jazz">Jazz</option>
        <option value="bass">Bass</option>
        <option value="treble">Treble</option>
        <option value="classic">Classic</option>
        <option value="dance">Dance</option>
      </select>

      <select id="presetB">
        <option value="flat">Flat</option>
        <option value="rock">Rock</option>
        <option value="pop">Pop</option>
        <option value="jazz">Jazz</option>
        <option value="bass">Bass</option>
        <option value="treble">Treble</option>
        <option value="classic">Classic</option>
        <option value="dance">Dance</option>
      </select>

      <input type="range" id="blendRatio" min="0" max="1" step="0.05" value="0.5" />
    </div>

    <div id="manual-eq-sliders">
      <div class="eq-col"><input class="eq-slider" type="range" /><span>32Hz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>64Hz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>125Hz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>250Hz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>500Hz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>1kHz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>2kHz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>4kHz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>8kHz</span></div>
      <div class="eq-col"><input class="eq-slider" type="range" /><span>16kHz</span></div>
    </div>
  </div>

  <canvas id="visualizer"></canvas>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const audioPlayer = document.getElementById("audioPlayer");
    const folderPicker = document.getElementById("folderPicker");
    const nowPlaying = document.getElementById("nowPlaying");
    const volumeRange = document.getElementById("volumeRange");
    const gainInfo = document.getElementById("gain-info");
    const presetSelect = document.getElementById("preset-select");
    const toggleBtn = document.getElementById("toggleClarity");
    const blendBtn = document.getElementById("blendToggleBtn");
    const blendStatus = document.getElementById("blendStatus");
    const status = document.getElementById("status");
    const playerContainer = document.querySelector(".player-container");

    let audioCtx, sourceNode, gainNode, compressor, biquadFilter, analyser;
    let eqFilters = [], eqSliders = [], playlist = [], currentIndex = 0;
    let clarityMode = false, blendMode = false;

    const presets = {
      flat:    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      bass:    [6, 4, 2, 1, 0, -1, -2, -3, -4, -5],
      treble:  [-5, -4, -3, -2, -1, 0, 1, 2, 4, 6],
      rock:    [5, 3, 2, 0, 0, 1, 3, 5, 3, 2],
      pop:     [2, 3, 4, 3, 1, 0, 1, 3, 4, 2],
      jazz:    [1, 2, 3, 5, 4, 3, 2, 1, 0, -1],
      dance:   [6, 5, 3, 2, 1, 1, 2, 3, 5, 6],
      classic: [-2, -1, 0, 1, 2, 1, 0, -1, -2, -3]
    };

    function initAudioContext() {
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      sourceNode = audioCtx.createMediaElementSource(audioPlayer);
      gainNode = audioCtx.createGain();
      compressor = audioCtx.createDynamicsCompressor();
      biquadFilter = audioCtx.createBiquadFilter();

      const freqs = [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000, 16000];
      eqFilters = freqs.map(freq => {
        const filter = audioCtx.createBiquadFilter();
        filter.type = "peaking";
        filter.frequency.value = freq;
        filter.Q.value = 1;
        filter.gain.value = 0;
        return filter;
      });

      eqSliders = Array.from(document.querySelectorAll(".eq-slider"));
      eqSliders.forEach((slider, i) => {
        slider.min = -12;
        slider.max = 12;
        slider.step = 0.1;
        slider.value = 0;
        slider.addEventListener("input", () => {
          if (eqFilters[i]) {
            eqFilters[i].gain.setValueAtTime(parseFloat(slider.value), audioCtx.currentTime);
          }
        });
      });

      connectChain();
    }

    function connectChain() {
      disconnectAll();
      if (!sourceNode) return;
      let input = sourceNode;

      if (clarityMode) {
        const lowshelf = audioCtx.createBiquadFilter();
        lowshelf.type = "lowshelf";
        lowshelf.frequency.value = 150;
        lowshelf.gain.value = 6;

        const mid = audioCtx.createBiquadFilter();
        mid.type = "peaking";
        mid.frequency.value = 1000;
        mid.gain.value = 2;

        const highshelf = audioCtx.createBiquadFilter();
        highshelf.type = "highshelf";
        highshelf.frequency.value = 6000;
        highshelf.gain.value = 5;

        input.connect(lowshelf).connect(mid).connect(highshelf);
        input = highshelf;
      }

      eqFilters.forEach(f => input = input.connect(f));
      input.connect(biquadFilter);
      biquadFilter.connect(compressor);
      compressor.connect(gainNode);
      gainNode.connect(audioCtx.destination);

      if (!analyser) {
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 512;
        gainNode.connect(analyser);
        initVisualizer();
      } else {
        try { gainNode.disconnect(analyser); } catch {}
        gainNode.connect(analyser);
      }
    }

    function disconnectAll() {
      try { sourceNode.disconnect(); } catch {}
      eqFilters.forEach(f => { try { f.disconnect(); } catch {} });
      try { biquadFilter.disconnect(); } catch {}
      try { compressor.disconnect(); } catch {}
      try { gainNode.disconnect(); } catch {}
      try { analyser.disconnect(); } catch {}
    }

    function applyPreset(presetName) {
      const gains = presets[presetName] || presets["flat"];
      setEQGains(gains);
      updateSliders(gains);
      applyBiquadPreset(presetName);
    }

    function setEQGains(gainArray) {
      gainArray.forEach((gain, i) => {
        if (eqFilters[i]) {
          eqFilters[i].gain.setValueAtTime(gain, audioCtx.currentTime);
        }
      });
    }

    function updateSliders(gainArray) {
      gainArray.forEach((gain, i) => {
        if (eqSliders[i]) {
          eqSliders[i].value = gain;
        }
      });
    }

    function applyBiquadPreset(preset) {
      if (!biquadFilter) return;
      switch (preset) {
        case "jazz": biquadFilter.type = "peaking"; biquadFilter.frequency.value = 1000; biquadFilter.gain.value = 3; break;
        case "rock": biquadFilter.type = "peaking"; biquadFilter.frequency.value = 3000; biquadFilter.gain.value = 5; break;
        case "classic": biquadFilter.type = "lowpass"; biquadFilter.frequency.value = 10000; biquadFilter.gain.value = 0; break;
        case "pop": biquadFilter.type = "highshelf"; biquadFilter.frequency.value = 3000; biquadFilter.gain.value = 4; break;
        case "bass": biquadFilter.type = "lowshelf"; biquadFilter.frequency.value = 200; biquadFilter.gain.value = 6; break;
        case "treble": biquadFilter.type = "highshelf"; biquadFilter.frequency.value = 6000; biquadFilter.gain.value = 6; break;
        case "dance": biquadFilter.type = "peaking"; biquadFilter.frequency.value = 5000; biquadFilter.gain.value = 4; break;
        default: biquadFilter.type = "allpass"; biquadFilter.frequency.value = 440; biquadFilter.gain.value = 0;
      }
    }

    function blendPresets(presetA, presetB, ratio = 0.5) {
      const a = presets[presetA];
      const b = presets[presetB];
      if (!a || !b) return;
      const blended = a.map((val, i) => val * (1 - ratio) + b[i] * ratio);
      blended.forEach((val, i) => {
        if (eqFilters[i]) eqFilters[i].gain.setValueAtTime(val, audioCtx.currentTime);
        if (eqSliders[i]) eqSliders[i].value = val;
      });
    }

function initVisualizer() {
  const canvas = document.getElementById("visualizer");
  const ctx = canvas.getContext("2d");

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resize);
  resize();

  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);

  function draw() {
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const sparks = 50;
    for (let i = 0; i < sparks; i++) {
      const value = dataArray[i % bufferLength];
      const x1 = Math.random() * canvas.width;
      const y1 = Math.random() * canvas.height;
      const angle = Math.random() * Math.PI * 2;
      const length = value * 0.8 + Math.random() * 20;

      const x2 = x1 + Math.cos(angle) * length;
      const y2 = y1 + Math.sin(angle) * length;

      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.strokeStyle = `rgba(0,255,255,${Math.random() * 0.6 + 0.3})`;
      ctx.lineWidth = Math.random() * 2 + 1;
      ctx.shadowBlur = 20;
      ctx.shadowColor = "#0ff";
      ctx.stroke();
    }

    // Kilatan petir sekali-sekali
    if (Math.random() < 0.02) {
      ctx.fillStyle = "rgba(255,255,255,0.07)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
  }

  draw();
}

    function loadTrack() {
      const file = playlist[currentIndex];
      if (!file) return;
      const url = URL.createObjectURL(file);
      audioPlayer.src = url;
      audioPlayer.load();
      nowPlaying.textContent = "Now Playing: " + file.name;
      audioPlayer.play().catch(err => {
        console.error("Autoplay error:", err);
      });
    }

    folderPicker.addEventListener("change", (e) => {
      playlist = [...e.target.files].filter(f => f.type.startsWith("audio/"));
      if (playlist.length > 0) {
        currentIndex = 0;
        initAudioContext();
        loadTrack();
      }
    });

    audioPlayer.addEventListener("play", async () => {
      if (!audioCtx) initAudioContext();
      if (audioCtx.state === "suspended") await audioCtx.resume();
      playerContainer.classList.add("playing");
    });

    audioPlayer.addEventListener("pause", () => {
      playerContainer.classList.remove("playing");
    });

    volumeRange.addEventListener("input", () => {
      if (!audioCtx) return;
      gainNode.gain.setValueAtTime(parseFloat(volumeRange.value), audioCtx.currentTime);
      gainInfo.textContent = `üîä Volume: ${gainNode.gain.value.toFixed(2)}x`;
    });

    presetSelect.addEventListener("change", () => {
      if (!audioCtx) return;
      clarityMode = false;
      blendMode = false;
      status.textContent = "Clarity: OFF";
      blendStatus.textContent = "Blend: OFF";
      status.className = "status off";
      blendStatus.className = "status off";
      toggleBtn.innerText = "‚ú® Aktifkan Clarity";
      blendBtn.innerText = "üéõÔ∏è Aktifkan Blend";
      applyPreset(presetSelect.value);
      connectChain();
    });

    toggleBtn.addEventListener("click", () => {
      if (!audioCtx) return;
      clarityMode = !clarityMode;
      blendMode = false;
      blendStatus.textContent = "Blend: OFF";
      blendStatus.className = "status off";
      blendBtn.innerText = "üéõÔ∏è Aktifkan Blend";

      if (clarityMode) {
        const clarityPreset = [0, -4, -2, 0, 2, 4, 3, 1, 0, 0];
        setEQGains(clarityPreset);
        updateSliders(clarityPreset);
        status.textContent = "Clarity: ON";
        toggleBtn.innerText = "‚ùå Matikan Clarity";
        status.className = "status on";
      } else {
        applyPreset(presetSelect.value);
        status.textContent = "Clarity: OFF";
        toggleBtn.innerText = "‚ú® Aktifkan Clarity";
        status.className = "status off";
      }
      connectChain();
    });

    blendBtn.addEventListener("click", () => {
      if (!audioCtx) return;
      blendMode = !blendMode;
      clarityMode = false;
      status.textContent = "Clarity: OFF";
      status.className = "status off";
      toggleBtn.innerText = "‚ú® Aktifkan Clarity";

      const presetA = document.getElementById("presetA").value;
      const presetB = document.getElementById("presetB").value;
      const ratio = parseFloat(document.getElementById("blendRatio").value);

      if (blendMode) {
        blendPresets(presetA, presetB, ratio);
        blendStatus.textContent = "Blend: ON";
        blendStatus.className = "status on";
        blendBtn.innerText = "‚ùå Matikan Blend";
      } else {
        applyPreset(presetSelect.value);
        blendStatus.textContent = "Blend: OFF";
        blendStatus.className = "status off";
        blendBtn.innerText = "üéõÔ∏è Aktifkan Blend";
      }

      applyBiquadPreset(presetSelect.value);
      connectChain();
    });

    // Init default preset
    initAudioContext();
    applyPreset("flat");
  });
  </script>
</body>
</html>
